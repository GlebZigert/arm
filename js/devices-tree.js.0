.import "rif-plus.js" as RifPlus

var qml,
    services = {}

function init(q) {
    qml = q
}


function onSend(msg) {
    //var msg = JSON.parse(message)
    //root.log('Action: ', msg.action)
    if (msg.action in handlers)
        handlers[msg.action](msg.service, msg.data)
}

var handlers = {
    ListServices: function (service, list) {
        for (var i = 0; i < list.length; i++) {
            //root.log(JSON.stringify(list[i]))
            qml.send(list[i].Name, 'ListDevices', '')
        }
    },
    ListDevices: function (service, data) {
        if (root.devList.count === 0)
            services[service] = new RifPlus.Rif(data, root.devList, qml.tree)
         else
            qml.tree.model = root.devList

    },
    UpdateDevice: function (service, data) {
        services[service].updateTree(data)
    }
}
